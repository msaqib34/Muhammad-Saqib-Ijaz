<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visitor Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Visitor Statistics Dashboard</h1>
    <div>
        <canvas id="countryChart"></canvas>
    </div>
    <div>
        <canvas id="regionChart"></canvas>
    </div>
    <div>
        <canvas id="cityChart"></canvas>
    </div>
    <script>
       
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyBQGU7MvMSmktU_NZlz4Htbj0UD_XbOYKw",
          authDomain: "portfolio-788ca.firebaseapp.com",
          projectId: "portfolio-788ca",
          storageBucket: "portfolio-788ca.appspot.com",
          messagingSenderId: "543813603502",
          appId: "1:543813603502:web:3ae1ca5857457a79999d3f",
          measurementId: "G-26WRGQE3TF"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Function to fetch and display visitor stats
        async function displayVisitorStats() {
            const countryCounts = {};
            const regionCounts = {};
            const cityCounts = {};

            const snapshot = await db.collection('visitors').get();
            snapshot.forEach(doc => {
                const data = doc.data();
                countryCounts[data.country] = (countryCounts[data.country] || 0) + 1;
                regionCounts[data.region] = (regionCounts[data.region] || 0) + 1;
                cityCounts[data.city] = (cityCounts[data.city] || 0) + 1;
            });

            const countryLabels = Object.keys(countryCounts);
            const countryData = Object.values(countryCounts);

            const regionLabels = Object.keys(regionCounts);
            const regionData = Object.values(regionCounts);

            const cityLabels = Object.keys(cityCounts);
            const cityData = Object.values(cityCounts);

            new Chart(document.getElementById('countryChart'), {
                type: 'bar',
                data: {
                    labels: countryLabels,
                    datasets: [{
                        label: '# of Visitors by Country',
                        data: countryData,
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            new Chart(document.getElementById('regionChart'), {
                type: 'bar',
                data: {
                    labels: regionLabels,
                    datasets: [{
                        label: '# of Visitors by Region',
                        data: regionData,
                        backgroundColor: 'rgba(153, 102, 255, 0.2)',
                        borderColor: 'rgba(153, 102, 255, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            new Chart(document.getElementById('cityChart'), {
                type: 'bar',
                data: {
                    labels: cityLabels,
                    datasets: [{
                        label: '# of Visitors by City',
                        data: cityData,
                        backgroundColor: 'rgba(255, 159, 64, 0.2)',
                        borderColor: 'rgba(255, 159, 64, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Call displayVisitorStats after a short delay to ensure Firestore data is loaded
        setTimeout(displayVisitorStats, 2000);
    </script>
</body>
</html>
